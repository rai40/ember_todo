<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Little ember app</title>
    <script src="/assets/jquery.js" type="text/javascript"></script>
    <script src="/assets/handlebars.js" type="text/javascript"></script>
    <script src="/assets/ember.js" type="text/javascript"></script>
  </head>
  <body>
    <script type="text/javascript">
      //
      // APP
      //
      App = Ember.Application.create();

      //
      // ROUTER
      //
      App.Router.map(function() {
        this.route('about', {path: '/about'})
        this.route('why')
      });

      //
      // CLASSES
      //
      App.Person = Ember.Object.extend({
        firstName: "",
        lastName: "",

        fullName: function() {
          return [this.get("firstName"), this.get('lastName')].join(' ');
        }.property("firstName", "lastName")
      })

      App.Person.reopenClass({
        splitFullName: function(fullName) {
          names = fullName.split(' ');

          return {
            firstName: names[0],
            lastName: names.slice(1).join(' ')
          };
        },

        createFromFullName: function(fullName) {
          return this.create(this.splitFullName(fullName));
        }
      });


      //
      // CONTROLLERS
      //
      App.MeController = Ember.ObjectController.extend({
        content: App.Person.create({
          firstName: "Thorbjørn",
          lastName: "Hermansen"
        })
      });

      App.FriendsController = Ember.ArrayController.extend({
        content: [],

        newFriendName: "",

        addFriend: function() {
          this.pushObject(App.Person.createFromFullName(this.get('newFriendName')));
          this.set('newFriendName', '')
        }
      });
    </script>


    <script type="text/x-handlebars" id="application">
      <h1>Little Ember App</h1>
      {{partial "menu"}}
      {{outlet}}
    </script>

    <script type="text/x-handlebars" id="_menu">
      <ul>
        <li>{{#linkTo "index"}}Hjem{{/linkTo}}</li>
        <li>{{#linkTo "about"}}Om appen{{/linkTo}}</li>
        <li>{{#linkTo "why"}}Hvorfor?{{/linkTo}}</li>
      </ul>
    </script>


    <script type="text/x-handlebars" id="index">
      {{render "me"}}
      {{render "friends"}}
    </script>

    <script type="text/x-handlebars" id="about">
      Denne appen er laget av Thorbjørn.
    </script>

    <script type="text/x-handlebars" id="why">
      For å vise Ember.
    </script>


    <script type="text/x-handlebars" id="me">
      <h3>Mitt navn er: {{fullName}}<h3>
      <div>
        <label>
          Fornavn
          {{view Ember.TextField valueBinding="firstName"}}
        </label>
      </div>

      <div>
        <label>
          Fornavn
          {{view Ember.TextField valueBinding="lastName"}}
        </label>
      </div>
    </script>

    <script type="text/x-handlebars" id="friends">
      <h4>Jeg har {{length}} venner..</h4>

      <div>
        <label>Legg til venn..</label>
        {{view Ember.TextField valueBinding="newFriendName" action="addFriend"}}
        <button {{action addFriend}}>Legg til</button>
      </div>

      {{#each friend in controller}}
        <div>{{friend.fullName}}<div>
      {{else}}
      <p>Du kan legge til en venn!</p>
      {{/each}}
    </script>

  </body>
</html>
